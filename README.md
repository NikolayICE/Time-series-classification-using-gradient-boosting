# Документация коду

Этот скрипт выполняет следующие задачи:
1. Предобработка данных.
2. Построение нейронной сети для классификации сигналов.
3. Обучение двух моделей нейронных сетей (основной и упрощенной).
4. Сохранение и загрузка моделей.
5. Создание дополнительной модели XGBoost для улучшения качества классификации.

## Зависимости

Для работы скрипта требуются следующие библиотеки:
- `torch` и `torchvision` — для создания и обучения нейронной сети.
- `sklearn` — для работы с метриками, разделением данных и кодировкой меток.
- `pandas` — для обработки данных.
- `numpy` — для численных операций.
- `matplotlib` — для визуализации.
- `scipy`, `random`, `datetime` — дополнительные вспомогательные модули.
- `intel_extension_for_pytorch` — для оптимизации моделей PyTorch на платформе Intel.
- `xgboost` — для создания и обучения модели XGBoost.


```python
import torch
import torch.nn as nn
import torchvision
from sklearn.metrics import accuracy_score
from sklearn.model_selection import train_test_split
from torch.utils.data import Dataset, DataLoader
from tqdm.auto import tqdm
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import warnings
import intel_extension_for_pytorch as ipex
import scipy
import random
import datetime as dt
from sklearn.preprocessing import LabelEncoder
import sys, os
from xgboost import XGBClassifier
warnings.filterwarnings('ignore')
```

## Описание кода

### Чтение и предобработка данных

1. Загрузка обучающего и тестового набора данных из файлов `train.csv` и `test.csv`.
2. Кодировка категориальных признаков (`label`, `sex`, `patient`) с использованием `LabelEncoder`.
3. Обработка каждого файла с сигналом:
   - Загрузка данных сигнала из файлов.
   - Преобразование данных сигнала в numpy-массивы.
   - Создание векторных меток в формате one-hot encoding.

### Формирование оконных признаков

- Используется скользящее окно для вычисления средних значений по окнам фиксированного размера (3), чтобы сократить шум и уменьшить размерность данных.

### Разделение данных на обучающую и тестовую выборки

- Данные `signals_train` и `train_labels` делятся на обучающую и тестовую выборки для последующего обучения модели.

### Определение класса Dataset

Класс `CoolDataset` используется для преобразования данных в формат, пригодный для использования в `DataLoader` PyTorch. Он принимает на вход признаки (`x`) и метки (`y`), преобразует их в тензоры и реализует стандартные методы `__len__` и `__getitem__`.

```python
class CoolDataset(Dataset):
    ... 
 ```
### Определение нейронной сети
- В коде определены две архитектуры нейронной сети:

	- Net — полная модель для классификации сигналов.
	- Net_light — облегченная версия модели, с меньшим количеством слоев.

Обе модели используют сверточные слои, слои нормализации, нелинейности (ReLU, ELU), дроп-аут и полносвязные слои для классификации.

```python
class Net(nn.Module):
    ...
 ```

### Настройка оптимизаторов и функции потерь

- Для каждой модели определен оптимизатор Adam с начальной скоростью обучения 0.0001 и регуляризацией weight_decay=0.001.
- Настроены планировщики для управления скоростью обучения: CosineAnnealingLR и ExponentialLR.
- Функция потерь — BCELoss, поскольку задача классификации бинарная.

### Обучение моделей

В процессе обучения на каждом этапе вычисляются:

>  Средние потери (mean_loss) и точность (mean_acc) на обучающей выборке.
Проводится валидация на тестовой выборке каждые 10 эпох.

### Создание и обучение модели XGBoost

- Для повышения точности классификации применяется модель XGBClassifier.
- Модель обучается на выходах (предсказаниях) нейронной сети, что позволяет комбинировать предсказания для улучшения качества.

### Тестирование и создание файла с предсказаниями


1.	Генерация предсказаний для тестового набора данных с использованием обученных моделей Net, Net_light и XGBoost.
	
2.	Формирование финального DataFrame с именами файлов и предсказанными метками.
	
3.	Сохранение результатов предсказаний в файл ans.csv.

```python
ans.to_csv('ans.csv', index=False)
 ```

### Структура выходных файлов

1.	`model.pt` — сохраненные веса полной модели Net.
2. `model_light.pt` — сохраненные веса облегченной модели Net_light.
3.	`ans.csv` — файл с предсказанными метками для тестовых данных.

## Заключение

#### Этот код включает в себя полный цикл подготовки, обучения и тестирования моделей машинного обучения для задачи классификации сигналов, с последующим улучшением точности за счет комбинации нейронных сетей и модели XGBoost.